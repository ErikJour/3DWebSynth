import{S as Pn,P as Sn,W as xn,a as Ln,V as Cn,R as Gn,M as Fn,s as Ne,N as kn,g as pe,F as En,b as On,C as B,T as Rn,c as zt,d as ce,B as Tn,e as d,f as g,D as me,h as At,G as f,i as Hn,H as Dn,j as v,k as R,O as ye,l as qe,E as Be,m as zn,n as An,o as _,p as y,q as W,r as In,t as It,I as Wn,u as Yn,v as jn,w as Nn,x as qn}from"./vendor-CztYBbk_.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const a=new Pn,Bn=document.querySelector("canvas.webgl"),r=new Cn,u=new Gn,E={width:window.innerWidth,height:window.innerHeight},l=new Sn(75,E.width/E.height);l.position.set(0,0,45);const X=new xn({canvas:Bn,antialias:!0});X.setSize(E.width,E.height);X.shadowMap.enabled=!0;X.shadowMap.type=Ln;X.setPixelRatio(Math.min(window.devicePixelRatio,2));window.addEventListener("resize",()=>{E.width=window.innerWidth,E.height=window.innerHeight,l.aspect=E.width/E.height,l.updateProjectionMatrix(),X.setSize(E.width,E.height),X.setPixelRatio(Math.min(window.devicePixelRatio,2))});const p=new Fn({oscillator:{type:"sawtooth"},envelope:{attack:.01,decay:.1,sustain:.9,release:.5}});Ne();const x=new kn;p.volume.value=pe(0);p.oscillator.type="sine";p.envelope.attack=.05;p.envelope.sustain=.4;p.envelope.release=.2;x.envelope.attack=.05;x.envelope.sustain=.2;x.envelope.release=.2;window.addEventListener("click",()=>{Ne(),console.log("Audio Context Started")});p.filter.frequency.value=0;const $=new En({type:"lowpass",frequency:2e4,rolloff:-24,Q:1}).toDestination();p.filterEnvelope.attack=0;p.filterEnvelope.decay=0;p.filterEnvelope.sustain=0;p.filterEnvelope.release=0;p.connect($);x.connect($);$.attack=0;$.decay=0;$.sustain=0;$.release=0;x.volume.value=pe(0);window.addEventListener("keydown",async()=>{await Ne()});window.addEventListener("click",async()=>{await Ne(),console.log("Audio Context Started")});On().start();const K=new B(13145664),U=new B(16746496),V=new B(33413),O={neutraBeige:"#D9D4C5",sageGreen:"#A8B79A",warmGray:"#A9A39B",terracotta:"#C67650",paleSkyBlue:"#9EB8C2",oliveBrown:"#5A5A44",sunlitSand:"#E5C69F",mutedTeal:"#6E8D90",charcoalGray:"#4A4A4A"},Xn=new B(O.terracotta).lerp(new B(8421504),.001),_n=new B(V).lerp(new B(8421504),.2),P=new Rn;P.load("textures/stainedGlassA.png");P.load("textures/OceanWave.jpeg");const Wt=P.load("textures/stainedGlassWaveB.jpg");P.load("textures/stainedGlassD.jpg");P.load("textures/Greydient4A_silk_3.png");const Yt=P.load("textures/Greydient4A_texture1_5.jpg"),$n=P.load("textures/Greydient4B_texture1_6.jpg"),Kn=P.load("textures/Greydient4C_texture1_3.jpg");P.load("matcaps/0_export_2.png");const Un=P.load("matcaps/0_export_6.png");P.load("matcaps/0_export_25.png");const Vn=P.load("matcaps/export_92_blur.png"),Rt=10,Zn=150,jt=new zt(Rt,Rt,Zn,32,16,!1);jt.computeVertexNormals();const Oe=new ce({map:Yt,color:O.terracotta,side:Tn}),fe=new d(jt,Oe);fe.rotation.x=Math.PI/2;fe.position.z=-20;fe.receiveShadow=!0;fe.castShadow=!0;const de=new g({color:U,opacity:0,transparent:!0,roughness:.5,metalness:.1}),Nt=new ce({color:V,emissive:4521796,emissiveIntensity:.9,transparent:!0,opacity:.25,side:me}),Qn=new ce({color:V,emissive:4521796,emissiveIntensity:.9,transparent:!0,opacity:.25,side:me}),Jn=new ce({color:V,emissive:4521796,emissiveIntensity:.9,transparent:!0,opacity:.25,side:me}),eo=new ce({color:V,emissive:4521796,emissiveIntensity:.9,transparent:!0,opacity:.25,side:me}),to=new ce({color:V,emissive:4521796,emissiveIntensity:.9,transparent:!0,opacity:.25,side:me});new g({map:Wt,color:16755268,emissive:16729344,emissiveIntensity:.5,transparent:!1,opacity:.7});const no=new g({color:O.neutraBeige,emissiveIntensity:.2,transparent:!1,opacity:1}),wt=new g({color:U,opacity:.5,transparent:!0,roughness:.5,metalness:.1}),L=new g({color:U});L.roughness=.4;L.metalness=.1;const Xe=new At({color:O.terracotta});Xe.matcap=Un;Xe.roughness=.4;Xe.metalness=.1;const pt=new At({color:K});pt.matcap=Vn;pt.roughness=.9;pt.metalness=.1;const Y=new f;function qt(e,t,n){const o=new Hn(.5,32),s=new d(o,Nt);s.position.set(e,t,-2),s.scale.set(.2,.2,.2),Y.add(s)}const oo=-1.25,so=-1.05,Bt=-.26,Xt=.24;for(let e=0;e<3;e++)qt(Bt+e*Xt,oo);for(let e=3;e<5;e++)qt(Bt+(e-3)*Xt+.13,so);const Z=Y.children[0];Z.material=Nt;const Q=Y.children[3];Q.material=Qn;const J=Y.children[1];J.material=Jn;const ee=Y.children[4];ee.material=eo;const te=Y.children[2];te.material=to;const io=.5,ao=new Dn(16777215,K,io),ge=new g({map:Wt,color:16755268,emissive:16729344,emissiveIntensity:.5,transparent:!1,opacity:.7}),ro=new g({color:O.neutraBeige,emissiveIntensity:.2,transparent:!1,opacity:1}),_t=new v(1,32,32),ve=Math.PI*.12,be=.3,Me=1.5,Pe=50,_e=5,mt=0,co=0,yt=15,$t=10,T=new R(K,3);T.position.set(mt,$t,yt);T.angle=ve;T.penumbra=be;T.decay=Me;T.distance=Pe;T.intensity=_e;const ft=new ye;ft.position.set(mt,co,yt);T.target=ft;const lo=new v(1,32,32),$e=new d(lo,ge);$e.position.set(mt,$t,yt);const gt=0,uo=0,vt=-5,Kt=10,H=new R(K,3);H.position.set(gt,Kt,vt);H.angle=ve;H.penumbra=be;H.decay=Me;H.distance=Pe;H.intensity=_e;const bt=new ye;bt.position.set(gt,uo,vt);H.target=bt;const ho=new v(1,32,32),Ut=new d(ho,ge);Ut.position.set(gt,Kt,vt);const Mt=0,wo=0,Vt=-25,po=10,D=new R(K,3);D.position.set(Mt,10,-25);D.angle=ve;D.penumbra=be;D.decay=Me;D.distance=Pe;D.intensity=_e;const Pt=new ye;Pt.position.set(Mt,wo,Vt);D.target=Pt;const mo=new v(1,32,32),St=new d(mo,ge);St.position.set(Mt,po,Vt);const S=new R(K,3);S.position.set(0,10,-45);S.angle=ve;S.penumbra=be;S.decay=Me;S.distance=Pe;S.intensity=_e;const xt=new ye;xt.position.set(0,0,-45);S.target=xt;const yo=new v(1,32,32),q=new d(yo,ge);q.position.set(0,10,-45);q.visible=!1;const ue=new d(_t,ro);ue.position.set(0,10,-45);ue.visible=!0;S.intensity=0;const j=new R(K,3);j.position.set(0,10,-65);j.angle=ve;j.penumbra=be;j.decay=Me;j.distance=Pe;const Lt=new ye;Lt.position.set(0,0,-65);j.target=Lt;const Ct=new d(_t,ge);Ct.position.set(0,10,-65);j.visible=!0;j.intensity=5;const z=new R(16755251,.5);z.position.set(-3,6,20);z.angle=Math.PI/1.5;z.penumbra=.9;z.decay=.2;z.distance=20;z.castShadow=!0;z.shadow.mapSize.width=256;z.shadow.mapSize.height=256;const C=new R(16755251,5);C.position.set(-3,6,0);C.angle=Math.PI/1.7;C.penumbra=.7;C.decay=.2;C.distance=20;C.castShadow=!0;C.shadow.mapSize.width=256;C.shadow.mapSize.height=256;C.intensity=.4;const G=new R(16755251,5);G.position.set(-3,6,-20);G.angle=Math.PI/1.5;G.penumbra=.9;G.decay=.2;G.distance=20;G.castShadow=!0;G.shadow.mapSize.width=256;G.shadow.mapSize.height=256;G.intensity=.3;const F=new R(16755251,5);F.position.set(-3,6,-45);F.angle=Math.PI/1.5;F.penumbra=.9;F.decay=.2;F.distance=20;F.castShadow=!0;F.shadow.mapSize.width=256;F.shadow.mapSize.height=256;F.intensity=.3;const k=new R(16755251,5);k.position.set(-3,6,-64);k.angle=Math.PI/1.5;k.penumbra=.9;k.decay=.2;k.distance=20;k.castShadow=!0;k.shadow.mapSize.width=256;k.shadow.mapSize.height=256;k.intensity=.3;function Zt(e,t,n,o,s,i){const h=new qe,c=1e-5,w=e/i;h.moveTo(-e/2,0);for(let m=0;m<=i;m++){const I=-e/2+m*w,M=Math.sin(m/i*Math.PI*2)*(t/2);m===0?h.lineTo(I,M):h.quadraticCurveTo(I-w/2,M,I,M)}for(let m=i;m>=0;m--){const I=-e/2+m*w,M=Math.sin(m/i*Math.PI*2)*(t/2);h.lineTo(I,M+c)}const b={steps:1,depth:n,bevelEnabled:!0,bevelThickness:o,bevelSize:o,bevelSegments:4},A=new Be(h,b);return A.center(),A}const Qt=1.33,Se=.665,Jt=.266,en=.0665,fo=Zt(Qt,Se,Jt,en,16,64),Re=new d(fo,L);Re.visible=!0;function tn(e,t,n,o,s){const i=new qe,c=o-1e-5;i.moveTo(0,c),i.lineTo(0,t-c),i.quadraticCurveTo(0,t,c,t),i.lineTo(e-c,t),i.quadraticCurveTo(e,t,e,t-c),i.lineTo(e,c),i.quadraticCurveTo(e,0,e-c,0),i.lineTo(c,0),i.quadraticCurveTo(0,0,0,c);const w=new Be(i,{depth:n-o*2,bevelEnabled:!0,bevelSegments:s*2,steps:1,bevelSize:o,bevelThickness:o,curveSegments:s});return w.center(),w}const go=tn(.8,.8,.8,.05,16),Te=new d(go,L);Te.visible=!1;function Ke(e,t,n,o,s){const i=new qe,c=o-1e-5,w=e/2;i.moveTo(-w+c,-t/2),i.lineTo(w-c,-t/2),i.quadraticCurveTo(w,-t/2,w,-t/2+c),i.lineTo(c,t/2-c),i.quadraticCurveTo(0,t/2,-c,t/2-c),i.lineTo(-w,-t/2+c),i.quadraticCurveTo(-w,-t/2,-w+c,-t/2);const b={steps:1,depth:n,bevelEnabled:!0,bevelThickness:o,bevelSize:o,bevelSegments:s},A=new Be(i,b);return A.center(),A}const vo=Ke(1,.866,.2,.05,4),He=new d(vo,L);He.visible=!1;class bo{constructor(t,n,o,s,i,h,c){this.raycaster=t,this.camera=n,this.rings=o,this.synth=s,this.noise=i,this.colorPalette=h,this.tunnelColor=c,this.mouse=r,this.isHoldingRootRing=!1,this.isHoldingThirdRing=!1,this.isHoldingFourth=!1,this.isHoldingFifth=!1,this.isHoldingSeventh=!1,this.isNoteOn=!1,this.octaveOffset=0,this.activeKey=null,this.initListeners()}initListeners(){window.addEventListener("mousedown",t=>this.handleMouseDown(t)),window.addEventListener("mouseup",t=>this.handleMouseUp(t)),window.addEventListener("keydown",t=>this.handleKeyDown(t)),window.addEventListener("keyup",t=>this.handleKeyUp(t))}handleMouseDown(t){this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=-(t.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const n=this.raycaster.intersectObjects(this.rings);if(n.length>0){this.isNoteOn=!0;const o=n[0].object;o===Z?(this.isHoldingRootRing=!0,this.playNote("D3",Z,.2)):o===Q?(this.isHoldingThirdRing=!0,this.playNote("F#3",Q,.3)):o===J?(this.isHoldingFourth=!0,this.playNote("G3",J,.5)):o===ee?(this.isHoldingFifth=!0,this.playNote("A3",ee,.6)):o===te&&(this.isHoldingSeventh=!0,this.playNote("C4",te,.8))}}handleMouseUp(){this.isNoteOn=!1,this.releaseNote()}handleKeyDown(t){t.preventDefault();const n=t.key;if(this.activeKey!=n)switch(this.activeKey=n,this.isNoteOn=!0,n){case"j":this.isHoldingRootRing=!0,this.playNote("D3",Z,.2);break;case"k":this.isHoldingFourth=!0,this.playNote("G3",J,.5);break;case"l":this.isHoldingSeventh=!0,this.playNote("C4",te,.8);break;case"i":this.isHoldingThirdRing=!0,this.playNote("F#3",Q,.3);break;case"o":this.isHoldingFifth=!0,this.playNote("A3",ee,.6);break;case"ArrowDown":this.octaveOffset=Math.max(this.octaveOffset-1,-2),console.log(`Octave: ${this.octaveOffset}`);break;case"ArrowUp":this.octaveOffset=Math.min(this.octaveOffset+1,2),console.log(`Octave: ${this.octaveOffset}`);break}}handleKeyUp(){this.isNoteOn=!1,this.activeKey=null,this.releaseNote()}playNote(t,n,o){const s=t.slice(0,-1),h=parseInt(t.slice(-1))+this.octaveOffset,c=`${s}${h}`;if(!/^[A-G]#?\d$/.test(c)){console.error(`Invalid note format: ${c}`);return}console.log(`Playing note: ${c}`),this.synth.triggerAttackRelease(c,"8n"),this.noise.triggerAttackRelease("8n"),this.oscillationFrequency=o,n.material.color.set(this.colorPalette.paleSkyBlue),n.material.opacity=.9}releaseNote(){this.synth.triggerRelease(),this.noise.triggerRelease(),this.isHoldingRootRing&&(Z.material.color.set(this.tunnelColor),Z.material.opacity=.25,this.isHoldingRootRing=!1),this.isHoldingThirdRing&&(Q.material.color.set(this.tunnelColor),Q.material.opacity=.25,this.isHoldingThirdRing=!1),this.isHoldingFourth&&(J.material.color.set(this.tunnelColor),J.material.opacity=.25,this.isHoldingFourth=!1),this.isHoldingFifth&&(ee.material.color.set(this.tunnelColor),ee.material.opacity=.25,this.isHoldingFifth=!1),this.isHoldingSeventh&&(te.material.color.set(this.tunnelColor),te.material.opacity=.25,this.isHoldingSeventh=!1)}}a.add(l);a.add(Y);l.add(Y);const Mo=Y.children,Po=O.paleSkyBlue,So=V;new bo(u,l,Mo,p,x,Po,So);a.add(ao);a.add(T);a.add(ft);a.add($e);a.add(H);a.add(bt);a.add(Ut);a.add(D);a.add(Pt);a.add(St);a.add(S);a.add(xt);a.add(q);a.add(ue);a.add(j);a.add(Lt);a.add(Ct);a.add(z);a.add(C);a.add(G);a.add(F);a.add(k);a.fog=new zn(Xn,20,70);a.fog=new An(_n,.01);a.add(fe);const le=new f;le.add(Re);le.add(Te);le.add(He);le.position.set(0,0,15);a.add(le);const xo=16,Lo=64,Co=1,Go=.866,Fo=.2,ko=.05,Eo=4,Oo=Zt(Qt/3,Se/3,Jt/3,en/3,xo,Lo),xe=new d(Oo,wt);xe.position.set(0,Se/2+.65,15);a.add(xe);const Ro=Ke(Co/3,Go/3,Fo/3,ko/3,Eo),Le=new d(Ro,wt),To=tn(.8/3,.8/3,.8/3,.05/3,16),Ce=new d(To,wt);a.add(Le,Ce);const Ho=.7;Le.position.set(-.7,Se/2+.5,15);Ce.position.set(Ho,Se/2+.5,15);xe.visible=!0;Le.visible=!0;Ce.visible=!0;const Ge=new f;Ge.add(xe);Ge.add(Le);Ge.add(Ce);a.add(Ge);let Tt="sine";const Ht=[{mesh:xe,shape:"sine"},{mesh:Le,shape:"pyramid"},{mesh:Ce,shape:"cube"}];window.addEventListener("click",e=>{var n;r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects([...Ht.map(o=>o.mesh),$e]);if(t.length>0){const o=t[0].object,s=(n=Ht.find(i=>i.mesh===o))==null?void 0:n.shape;s&&Do(s)}});function Do(e){e!==Tt&&(Re.visible=e==="sine",He.visible=e==="pyramid",Te.visible=e==="cube",e==="sine"?(Re.visible=!0,Oe.map=Yt,p.oscillator.type="sine"):e==="pyramid"?(He.visible=!0,Oe.map=$n,p.oscillator.type="triangle"):e==="cube"&&(Te.visible=!0,Oe.map=Kn,p.oscillator.type="square"),Tt=e)}const zo=.15;p.volume.value=pe(zo);const Fe=new f;a.add(Fe);const De=7,at=.2,Ao=.05,Io=new g({color:U,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<De;e++){const t=new v(Ao,16,16),n=new d(t,Io.clone());n.position.set(1.5,e*at,15),Fe.add(n)}let N=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(Fe.children);t.length>0&&(N=t[0].object,N.scale.set(2,2,2))});T.intensity=1;window.addEventListener("mousemove",e=>{if(N){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-N.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,De*at);N.position.y=o;const s=o/(De*at);nn(s*100),p.volume.value=pe(s/2);const i=s*5;T.intensity=i,N.visible=!0}});window.addEventListener("mouseup",()=>{N=null});function nn(e){const t=Math.round(e/100*De);Fe.children.forEach((n,o)=>{n.material.opacity=o<t?1:.3})}nn(15);const Ue=new f;Ue.add(le);Ue.add(Ge);Ue.add(Fe);a.add(Ue);const Wo=0,Yo=0,jo=-5,he=new f;a.add(he);new In({color:U,transparent:!0,opacity:.5});const No=new It(.02,.02,.02);function qo(e){const t=new d(No,no),n=4,o=Math.random()*Math.PI*5,s=Math.acos(2*Math.random()-1);return t.position.set(n*Math.sin(s)*Math.cos(o),n*Math.sin(s)*Math.sin(o),n*Math.cos(s)),t.velocity=new y((Math.random()-.5)*.01,(Math.random()-.5)*.01,(Math.random()-.5)*.01),t}function on(e,t){he.clear();for(let n=0;n<e;n++)he.add(qo());console.log("Sending grain count to backend:",e)}he.position.set(Wo,Yo,jo);on(500);const Ve=new f;a.add(Ve);const ze=7,rt=.2,Bo=.05,Xo=new g({color:U,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<ze;e++){const t=new v(Bo,16,16),n=new d(t,Xo.clone());n.position.set(0+2.5,e*rt,-5),Ve.add(n)}let ne=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(Ve.children);t.length>0&&(ne=t[0].object,ne.scale.set(2,2,2))});H.intensity=1;window.addEventListener("mousemove",e=>{if(ne){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-ne.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,ze*rt);ne.position.y=o;const s=o/(ze*rt);x.volume.value=pe(s/2),on(s*500),_o(s*100);const i=s*5;H.intensity=i}});window.addEventListener("mouseup",()=>{ne=null});function _o(e){const t=Math.round(e/100*ze);Ve.children.forEach((n,o)=>{n.material.opacity=o<t?1:.3})}function $o(e,t,n,o,s){const i=new f,h=new qe;h.moveTo(-2.5/2,0),h.lineTo(e/2,0);const c=W.degToRad(s),w=Math.cos(c)*t,b=-Math.sin(c)*t;h.lineTo(e/2+w,b),h.quadraticCurveTo(e/2,0,-2.5/2,.2);const A={steps:10,depth:n,bevelEnabled:!0,bevelThickness:o*3,bevelSize:o,bevelSegments:32},m=new Be(h,A);m.center();const I=new d(m,L);return i.add(I),i}const Ko=2.5,Uo=2,Vo=.1,Zo=.2,Qo=30,sn=$o(Ko,Uo,Vo,Zo,Qo);sn.position.set(0,0,-26);a.add(sn);const Ze=new f;a.add(Ze);const Ae=7,ct=.2,Jo=.05,es=new g({color:U,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<Ae;e++){const t=new v(Jo,16,16),n=new d(t,es.clone());n.position.set(1.5,e*ct,-25),Ze.add(n)}let oe=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(Ze.children);t.length>0&&(oe=t[0].object,oe.scale.set(2,2,2))});D.intensity=1;window.addEventListener("mousemove",e=>{if(oe){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-oe.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,Ae*ct);oe.position.y=o;const s=o/(Ae*ct),i=20,c=i*Math.pow(2e4/i,s);$.frequency.value=c,console.log("Logarithmic Filter Cutoff Frequency:",c),console.log(s*2e4),ts(s*100);const w=s*5;D.intensity=w}});window.addEventListener("mouseup",()=>{oe=null});function ts(e){const t=Math.round(e/100*Ae);Ze.children.forEach((n,o)=>{n.material.opacity=o<t?1:.3})}const Qe=new f,ns=25,os=1.5;for(let e=0;e<ns;e++){const t=os+(Math.random()-.5)*.1,n=Math.random()*Math.PI*2;let o;const s=Math.random();s<.33?o=new v(.05*Math.random()+.03,8,8):s<.66?o=new It(.05*Math.random()+.03,.05*Math.random()+.03,.05*Math.random()+.03):o=new Wn(.05*Math.random()+.03,0);const i=new d(o,L);i.position.set(t*Math.cos(n),t*Math.sin(n),0),i.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),i.userData={initialPosition:i.position.clone(),scale:1},Qe.add(i)}Qe.position.set(0,0,-45);a.add(Qe);const ss=new zt(2,2,.1,32),is=new g({opacity:0,transparent:!0}),an=new d(ss,is);an.rotation.x=Math.PI/2;an.position.z=-45;function as(){const e=Date.now()*.001;Qe.children.forEach(t=>{const{initialPosition:n,scale:o}=t.userData;t.position.x=n.x+Math.sin(e+t.id)*.1,t.position.y=n.y+Math.cos(e+t.id)*.1,t.scale.set(o,o,o)})}const rs=new Yn;rs.load("fonts/P22 FLLW Exhibition_Regular.json",function(e){function t(bn,Mn){return new qn(bn,{font:Mn,size:11,height:2,curveSegments:12,bevelEnabled:!0,bevelThickness:.1,bevelSize:.5,bevelOffset:0,bevelSegments:5})}const n=t("A",e);t("D",e),t("S",e),t("R",e),new jn,new d(n,Xe);const o=.08,s=t("OSC",e),i=new d(s,de);i.position.set(-2.7,8,18.4),i.scale.set(o,o,o),i.rotation.x=Math.PI/2,i.castShadow=!0,i.receiveShadow=!0,i.transparent=!0,a.add(i),z.target=$e;const h=t("Noise",e),c=new d(h,de);c.position.set(-3.2,8,-1.6),c.scale.set(o,o,o),c.rotation.x=Math.PI/2,c.castShadow=!0,c.transparent=!0,a.add(c),C.target=c;const w=t("Filter",e),b=new d(w,de);b.position.set(-2.9,8,-21.6),b.scale.set(o,o,o),b.rotation.x=Math.PI/2,b.castShadow=!0,b.transparent=!0,a.add(b),G.target=St;const A=t("LFO",e),m=new d(A,de);m.position.set(-2.8,7.5,-44.3),m.scale.set(o,o,o),m.rotation.x=Math.PI/2,m.castShadow=!0,m.transparent=!0,a.add(m),F.target=q;const I=t("adsr",e),M=new d(I,de);M.position.set(-3.5,7.7,-63.7),M.scale.set(o,o,o),M.rotation.x=Math.PI/2,M.castShadow=!0,M.transparent=!0,a.add(M),k.target=Ct});const Je=new f;a.add(Je);const Ie=10,lt=.2,cs=.05,ls=new g({color:L,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<Ie;e++){const t=new v(cs,16,16),n=new d(t,ls.clone());n.position.set(-3,e*lt,-65),Je.add(n)}let se=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(Je.children);t.length>0&&(se=t[0].object,se.scale.set(2,2,2))});window.addEventListener("mousemove",e=>{if(se){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-se.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,Ie*lt);se.position.y=o;const s=o/(Ie*lt);console.log(`Volume Level: ${s.toFixed(2)}`),p.envelope.attack=s,x.envelope.attack=s,rn(s*100)}});window.addEventListener("mouseup",()=>{se=null});function rn(e){const t=Math.round(e/100*Ie);Je.children.forEach((n,o)=>{o<t?n.material.opacity=1:n.material.opacity=.3})}rn(10);const et=new f;a.add(et);const We=10,dt=.2,ds=.05,us=new g({color:L,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<We;e++){const t=new v(ds,16,16),n=new d(t,us.clone());n.position.set(-1,e*dt,-65),et.add(n)}let ie=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(et.children);t.length>0&&(ie=t[0].object,ie.scale.set(2,2,2))});window.addEventListener("mousemove",e=>{if(ie){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-ie.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,We*dt);ie.position.y=o;const s=o/(We*dt);p.envelope.decay=s,x.envelope.decay=s,console.log(`Decay Level: ${s.toFixed(2)}`),cn(s*100)}});window.addEventListener("mouseup",()=>{ie=null});function cn(e){const t=Math.round(e/100*We);et.children.forEach((n,o)=>{o<t?n.material.opacity=1:n.material.opacity=.3})}cn(10);const tt=new f;a.add(tt);const Ye=10,ut=.2,hs=.05,ws=new g({color:L,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<Ye;e++){const t=new v(hs,16,16),n=new d(t,ws.clone());n.position.set(1,e*ut,-65),tt.add(n)}let ae=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(tt.children);t.length>0&&(ae=t[0].object,ae.scale.set(2,2,2))});window.addEventListener("mousemove",e=>{if(ae){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-ae.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,Ye*ut);ae.position.y=o;const s=o/(Ye*ut);p.envelope.sustain=s,x.envelope.sustain=s,ln(s*100)}});window.addEventListener("mouseup",()=>{ae=null});function ln(e){const t=Math.round(e/100*Ye);tt.children.forEach((n,o)=>{o<t?n.material.opacity=1:n.material.opacity=.3})}ln(10);const nt=new f;a.add(nt);const je=10,ht=.2,ps=.05,ms=new g({color:L,transparent:!0,opacity:.3,roughness:.5,metalness:.1});for(let e=0;e<je;e++){const t=new v(ps,16,16),n=new d(t,ms.clone());n.position.set(3,e*ht,-65),nt.add(n)}let re=null;window.addEventListener("mousedown",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=u.intersectObjects(nt.children);t.length>0&&(re=t[0].object,re.scale.set(2,2,2))});window.addEventListener("mousemove",e=>{if(re){r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l);const t=new _(new y(0,0,1),-re.position.z),n=new y;u.ray.intersectPlane(t,n);const o=W.clamp(n.y,0,je*ht);re.position.y=o;const s=o/(je*ht);p.envelope.release=s,x.envelope.release=s,dn(s*100)}});window.addEventListener("mouseup",()=>{re=null});function dn(e){const t=Math.round(e/100*je);nt.children.forEach((n,o)=>{o<t?n.material.opacity=1:n.material.opacity=.3})}dn(10);let Gt=!1,Ft=!1,kt=!1,Et=!1;const ys=.2,Dt=.02;window.addEventListener("keydown",e=>{switch(e.preventDefault(),e.key.toLowerCase()){case"w":Gt=!0,ke=0;break;case"s":Ft=!0,ke=0;break;case"a":kt=!0,ke=0;break;case"d":Et=!0,ke=0;break}});window.addEventListener("keyup",e=>{switch(e.key.toLowerCase()){case"w":Gt=!1;break;case"s":Ft=!1;break;case"a":kt=!1;break;case"d":Et=!1;break}});const un=.05,hn=.0466,wn=.001,pn=.0025,mn=4,we=new Nn({color:O.sageGreen}),fs=Ke(un,hn,wn,pn,mn),gs=new d(fs,we);gs.visible=!0;const ot=new f;function yn(e){const t=new f,n=Ke(un,hn,wn,pn,mn),o=new d(n,we);return o.position.y=0,t.add(o),t}const Ot=yn();Ot.scale.set(.1,.1,.1);const st=yn();st.scale.set(.1,.1,.1);st.rotation.z=Math.PI;const fn=.15,gn=-.035;Ot.position.set(fn,gn-.1,-.2);st.position.set(fn,gn-.108,-.2);ot.add(Ot);ot.add(st);a.add(ot);window.addEventListener("keydown",e=>{switch(e.preventDefault(),e.key){case"ArrowUp":we.color.set(O.sunlitSand),updateBackground();break;case"ArrowDown":we.color.set(O.oliveBrown),updateBackground();break}});window.addEventListener("keyup",e=>{switch(e.preventDefault(),e.key){case"ArrowUp":case"ArrowDown":we.color.set(O.sageGreen),updateBackground();break}});l.add(ot);let it=!1;window.addEventListener("click",e=>{r.x=e.clientX/window.innerWidth*2-1,r.y=-(e.clientY/window.innerHeight)*2+1,u.setFromCamera(r,l),u.intersectObject(q).length>0&&(q.visible=!q.visible,ue.visible=!ue.visible,it?(S.intensity=0,it=!1):(S.intensity=lightIntensity,it=!0))});let ke=.5;const Ee={minZ:-85,maxZ:45,radius:9.5};function vn(){requestAnimationFrame(vn),as(),kt&&(l.rotation.y+=Dt),Et&&(l.rotation.y-=Dt);const e=new y;l.getWorldDirection(e),Gt&&l.position.add(e.multiplyScalar(ys)),Ft&&l.position.add(e.multiplyScalar(-.2)),l.position.z=W.clamp(l.position.z,Ee.minZ,Ee.maxZ);const t=Math.sqrt(l.position.x**2+l.position.y**2);if(t>Ee.radius){const n=Ee.radius/t;l.position.x*=n,l.position.y*=n}he.children.forEach(n=>{n.position.add(n.velocity);const o=1.25;n.position.length()>o&&(n.position.normalize().multiplyScalar(o),n.velocity.negate()),n.material.opacity=3}),X.render(a,l)}vn();
